/*******************************************************************************  
**  
** Copyright (C) 2017 Zepto  
** Contact: http://www.sunhx.cn  
** E-mail: admin@sunhx.cn  
**  
*******************************************************************************/  
  
# Wireless Sensor Networks
# 农业温室无线传感节点

以 TI CC2530 为控制节点，通过 IIC 与光照强度传感器（OPT3001）、光线强度传感器（BH1750）、温湿度传感器（SHT20）和二氧化碳传感器（S100）通信进行数据读取，并通过 ZigBee 协议发送至上位机。  


# Software
  IAR Embedded Workbench for 8051 Version 8.10.1

# Hardware
  TI CC2530  
  TI OPT3001  
  ROHM BHT1750FVI  
  Sensirion SHT20  
  ELT S100  

# Document Tree
CC2530_V2.0
├──ide                      IAR工程文件  
└──source                   程序文件  
    ├──apps                 主程序  
    └──components           底层库函数  
        ├───basicrf         Basic RF 协议文件夹  
        |     ├───basic_rf.c            Basic RF 协议  
        |     ├───basic_rf.h            Basic RF 协议头文件  
        |     ├───basic_rf_security.c   Basic RF 协议安全通信部分  
        |     └───basic_rf_security.h   Basic RF 协议安全通信部分头文件  
        ├───awsnrf  
        |     ├───awsn_rf.c             AWSN RF 协议  
        |     └───awsn_rf.h             AWSN RF 协议头文件  
        ├───common          底层硬件函数  
        ├───iic             与IIC通信相关文件  
        |     ├───CC2530.c        main函数文件  
        |     ├───delay.h         延时函数头文件，定义部分类型缩写  
        |     ├───delay.c         延时函数代码  
        |     ├───iic.h           IIC函数头文件，定义IIC_SCL/IIC_SDA  
        |     ├───iic.c           IIC函数代码  
        |     ├───uart.h          Uart函数头文件  
        |     ├───uart.c          Uart函数代码  
        |     ├───opt3001.h       OPT3001头文件，定义各功能寄存器地址  
        |     ├───opt3001.c       OPT3001代码，光照传感器  
        |     ├───bh1750.h        BH1750头文件，定义各功能寄存器地址，错误信息  
        |     ├───bh1750.c        BH1750代码，光照传感器  
        |     ├───sht2x.h         SHT2x头文件，定义各功能寄存器地址  
        |     ├───sht2x.c         SHT2x代码，温湿度传感器  
        |     ├───sht1x.h         SHT1x头文件  
        |     ├───sht1x.h         SHT1x代码，温湿度传感器（在用）  
        |     ├───max44009.h      MAX44009头文件  
        |     └───max44009.h      MAX44009代码，光照传感器（在用）  
        └───radios          与无线通信相关底层文件  
  
  
# Protocal V2.0
        ┌──────┬──────────────┬─────────┬───────────┬────────────┬───────────┬─────────────┬───────┬──────┐  
MAC     |FCF(2)|Sep. Number(1)|Pan ID(2)|Rec. Add(2)|Tran. Add(2)|TX Power(1)|Cycle Time(1)|Data(n)|FCS(2)|  
        └──────┴──────────────┴─────────┴───────────┴────────────┴───────────┴─────────────┴───────┴──────┘  
  
                    ┌────────────┐  
            Enter   |IEEE Addr(8)|  
                    └────────────┘  
                    ┌─────────┬───────┐  
            Addr    |Pan ID(2)|Addr(2)|  
                    └─────────┴───────┘  
                    ┌───────┬──────┐  
            Ack     |Rssi(1)|LQI(1)|  
                    └───────┴──────┘  
                    ┌───────┐  
            Syn     |Time(1)|  
                    └───────┘  
                    ┌──────────────┬───────┐  
            Data    |Num + Error(1)|Data(2)|......  
                    └──────────────┴───────┘  
  
        ┌────┬────┬────────┐  
Uart_R  |0x01|0x02|CO2(0/1)|  
        ├────┴────┴┬─────┬─┴─────┬──────┬────────┬────────┐  
        |Addr[0x01]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x02]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x03]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x04]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x05]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x06]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x07]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x08]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼──────┬┴──────┴────────┴────────┘  
        |Addr[0x09]|error|CO2(4)|  
        ├──────────┼─────┼──────┤  
        |Addr[0x0A]|error|CO2(4)|  
        ├──────┬───┴─────┴──────┘  
        |CRC(2)|  
        └──────┘  
  
        ┌───────────┬───────┬────┬────────┐  
Uart_T  |Start(0xA5)|Command|Data|Checksum|  
        └───────────┴───────┴────┴────────┘  
  
        Error{  
          ACK_ERROR 			= 0x01  
          TIME_OUT_ERROR 	= 0x02  
          CHECKSUM_ERROR 	= 0x04  
          BATTERY_ALERT   = 0x08    
        }  
  
  
  
# Protocal V1.3
        ┌──────┬──────────────┬─────────┬───────────┬────────────┬───────┬──────┐  
MAC     |FCF(2)|Sep. Number(1)|Pan ID(2)|Rec. Add(2)|Tran. Add(2)|Data(n)|FCS(2)|  
        └──────┴──────────────┴─────────┴───────────┴────────────┴───────┴──────┘  
  
        ┌────┬────┬────────┐  
Uart_R  |0x01|0x02|CO2(0/1)|  
        ├────┴────┴┬─────┬─┴─────┬──────┬────────┬────────┐  
        |Addr[0x01]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x02]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x03]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x04]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤   
        |Addr[0x05]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x06]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x07]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼───────┼──────┼────────┼────────┤  
        |Addr[0x08]|error|Temp(4)|Hum(4)|Press(4)|Light(4)|  
        ├──────────┼─────┼──────┬┴──────┴────────┴────────┘  
        |Addr[0x09]|error|CO2(4)|  
        ├──────────┼─────┼──────┤  
        |Addr[0x0A]|error|CO2(4)|  
        ├──────┬───┴─────┴──────┘  
        |CRC(2)|  
        └──────┘  
  
        ┌───────────┬───────┬────┬────────┐  
Uart_T  |Start(0xA5)|Command|Data|Checksum|  
        └───────────┴───────┴────┴────────┘  
  
        Error{  
          ACK_ERROR 			= 0x01  
          TIME_OUT_ERROR 	= 0x02  
          CHECKSUM_ERROR 	= 0x04  
          BATTERY_ALERT   = 0x08    
        }  
  
  
# Protocal V1.2
        ┌──────┬──────────────┬─────────┬───────────┬────────────┬───────┬──────┐  
MAC     |FCF(2)|Sep. Number(1)|Pan ID(2)|Rec. Add(2)|Tran. Add(2)|Data(n)|FCS(2)|  
        └──────┴──────────────┴─────────┴───────────┴────────────┴───────┴──────┘  
  
        ┌─────────┬─────────┬─────┬───────┬───────┬──────┬──────┬─────┬─────┬────┬────┐  
Uart_R  |SrcAddr_H|SrcAddr_L|Error|Light_H|Light_L|Temp_H|Temp_L|Hum_H|Hum_L|'\r'|'\n'|  
        └─────────┴─────────┴─────┴───────┴───────┴──────┴──────┴─────┴─────┴────┴────┘  
  
        ┌───────┬───────┬──────┬──────┬─────┬─────┬────┬────┐  
Uart_T  |       |       |      |      |     |     |    |    |  
        └───────┴───────┴──────┴──────┴─────┴─────┴────┴────┘  
  
        Error{  
          ACK_ERROR 			= 0x01  
          TIME_OUT_ERROR 	= 0x02  
          CHECKSUM_ERROR 	= 0x04  
          BATTERY_ALERT   = 0x08    
        }  
  
  
# rotocal V1.1  
        ┌──────┬──────────────┬─────────┬───────────┬────────────┬───────┬──────┐  
MAC     |FCF(2)|Sep. Number(1)|Pan ID(2)|Rec. Add(2)|Tran. Add(2)|Data(n)|FCS(2)|  
        └──────┴──────────────┴─────────┴───────────┴────────────┴───────┴──────┘  
  
        ┌─────┬───────┬───────┬──────┬──────┬─────┬─────┬────┬────┐  
Uart_R  |Error|Light_H|Light_L|Temp_H|Temp_L|Hum_H|Hum_L|'\r'|'\n'|  
        └─────┴───────┴───────┴──────┴──────┴─────┴─────┴────┴────┘  
  
        ┌───────┬───────┬──────┬──────┬─────┬─────┬────┬────┐  
Uart_T  |       |       |      |      |     |     |    |    |  
        └───────┴───────┴──────┴──────┴─────┴─────┴────┴────┘  
  
        Error{  
          ACK_ERROR 			= 0x01  
          TIME_OUT_ERROR 	= 0x02  
          CHECKSUM_ERROR 	= 0x04  
          BATTERY_ALERT   = 0x08    
        }  



# rotocal V1.0
        ┌──────┬──────────────┬─────────┬───────────┬────────────┬───────┬──────┐  
MAC     |FCF(2)|Sep. Number(1)|Pan ID(2)|Rec. Add(2)|Tran. Add(2)|Data(n)|FCS(2)|  
        └──────┴──────────────┴─────────┴───────────┴────────────┴───────┴──────┘  
  
        ┌───────┬───────┬──────┬──────┬─────┬─────┬────┬────┐  
Uart_R  |Light_H|Light_L|Temp_H|Temp_L|Hum_H|Hum_L|'\r'|'\n'|  
        └───────┴───────┴──────┴──────┴─────┴─────┴────┴────┘  
  
        ┌───────┬───────┬──────┬──────┬─────┬─────┬────┬────┐  
Uart_T  |       |       |      |      |     |     |    |    |  
        └───────┴───────┴──────┴──────┴─────┴─────┴────┴────┘  
